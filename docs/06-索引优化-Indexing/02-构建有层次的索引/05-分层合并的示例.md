### 總覽
以 LlamaIndex 的 `RecursiveRetriever` 實作「主索引（場景描述） + 子索引（場景細節）」的分層檢索：主索引用於語義路由，命中後按 `index_id` 轉交子索引的查詢引擎，最後合成精煉回答。

### 流程圖
```mermaid
flowchart TD
  SCENE[場景描述 Documents] --> VIDX[VectorStoreIndex]
  DETAIL[場景詳細 Document per node] --> DIDX[VectorStoreIndex per detail]
  DIDX --> QEMAP[detail{i} → QueryEngine]
  SUM[IndexNode("該節點包含...", index_id=detail{i})] --> VIDX
  VIDX --> RR[RecursiveRetriever]
  Q[Query] --> RR --> ROUTE[命中 detail{i} → 該引擎]
  ROUTE --> SYN[get_response_synthesizer(compact)]
  SYN --> A[答案]
```

### 分步講解
- 主/子資料構建：主索引用場景摘要/描述，子索引對應詳盡設定文檔。
- IndexNode：以簡短文本代表子索引的能力，並提供 `index_id` 作為路由鍵。
- 檢索：`RecursiveRetriever("vector", retriever_dict, query_engine_dict)` 自動轉接查詢。
- 合成：`get_response_synthesizer(response_mode="compact")` 合併最終答案。

### 關鍵點總結
- **能力路由**：不同資料形態走不同查詢引擎，提高準確性。
- **可擴展**：可新增 SQL、Graph 等引擎，僅需增加對應 IndexNode 與映射。


