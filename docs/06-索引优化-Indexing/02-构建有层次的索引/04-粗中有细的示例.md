### 總覽
展示 LlamaIndex 的 `AutoMergingRetriever`：先用細粒度葉節點建索引以保證召回，再在檢索階段自動合併同源相鄰節點，輸出更完整的段落，兼顧「粗中有細」。

### 流程圖
```mermaid
flowchart TD
  D[Document] --> HNP[HierarchicalNodeParser 256/128/64]
  HNP --> LEAF[葉節點]
  LEAF --> VIDX[VectorStoreIndex]
  VIDX --> BR[base_retriever(k=6)]
  BR --> AMR[AutoMergingRetriever(verbose)]
  Q[Query] --> AMR --> NODES[合併後節點]
```

### 分步講解
- 層次切分：`HierarchicalNodeParser.from_defaults(chunk_sizes=[256,128,64])`。
- 建索引：以葉節點建立 `VectorStoreIndex`，提高命中機率。
- 自動合併：`AutoMergingRetriever(base_retriever, storage_context)` 將相鄰命中自動聚合。
- 對比：與基礎檢索器對照輸出節點數量與片段完整度。

### 關鍵點總結
- **層次優勢**：葉節點召回、根節點閱讀體驗。
- **存儲必要性**：需 `SimpleDocumentStore` 保存節點關係供合併使用。


